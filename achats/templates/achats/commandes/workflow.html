{% extends "achats/base_achats.html" %}

{% block achats_content %}
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            Validation de la commande #{{ commande.numero_commande }}
        </h6>
    </div>
    <div class="card-body">
        <div class="alert alert-warning">
            <h5>Confirmez-vous la validation de cette commande ?</h5>
            <p class="mb-0">
                Cette action enverra la commande au fournisseur et changera son statut en "Envoyée".
                Vous ne pourrez plus la modifier après validation.
            </p>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h5>Récapitulatif</h5>
                <table class="table table-sm table-borderless">
                    <tr>
                        <th>Fournisseur:</th>
                        <td>{{ commande.fournisseur.nom }}</td>
                    </tr>
                    <tr>
                        <th>Montant total:</th>
                        <td>{{ commande.get_montant_ttc|floatformat:2 }} {{ commande.devise.code }}</td>
                    </tr>
                    <tr>
                        <th>Nombre d'articles:</th>
                        <td>{{ commande.lignes.count }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <form method="post" action="{% url 'achats:valider_commande' commande.pk %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="commentaire">Commentaire (optionnel):</label>
                <textarea name="commentaire" id="commentaire" rows="3" class="form-control"></textarea>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Confirmer la validation
                </button>
                <a href="{% url 'achats:detail_commande' commande.pk %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Annuler
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}