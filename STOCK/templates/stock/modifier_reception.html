{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Modifier la Réception #{{ reception.numero }}</h2>

  <form method="post" novalidate>
    {% csrf_token %}
    
    <div class="card p-3 mb-4">
      <div class="row">
        <div class="col-md-4">
          {{ form.fournisseur.label_tag }} {{ form.fournisseur }}
        </div>
        <div class="col-md-4">
          {{ form.date_reception.label_tag }} {{ form.date_reception }}
        </div>
        <div class="col-md-4">
          <label for="id_devise">Devise</label>
          <select name="devise" id="id_devise" class="form-control" {% if reception.status != 'B' %}disabled{% endif %}>
            {% for code, nom in devises.items %}
              <option value="{{ code }}" {% if form.devise.value == code %}selected{% endif %}>{{ code }} - {{ nom }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-md-4">
          {{ form.numero.label_tag }} {{ form.numero }}
        </div>
        <div class="col-md-4">
          {{ form.status.label_tag }} {{ form.status }}
        </div>
        <div class="col-md-4">
          <label>Taux de change</label>
          <input type="text" class="form-control" value="{{ reception.taux_change|floatformat:2 }}" readonly>
        </div>
      </div>
    </div>

    <h5>Lignes de réception</h5>
    <div id="ligne-formset">
      {{ formset.management_form }}
      {% for form in formset %}
        <div class="card mb-2 p-3">
          <div class="row">
            <div class="col-md-3">{{ form.produit.label_tag }} {{ form.produit }}</div>
            <div class="col-md-2">{{ form.quantite.label_tag }} {{ form.quantite }}</div>
            <div class="col-md-2">{{ form.prix_unitaire.label_tag }} {{ form.prix_unitaire }}</div>
            <div class="col-md-2">{{ form.lot.label_tag }} {{ form.lot }}</div>
            <div class="col-md-3">{{ form.date_peremption.label_tag }} {{ form.date_peremption }}</div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-success">Enregistrer</button>
      <a href="{% url 'liste_receptions' %}" class="btn btn-secondary">Annuler</a>
    </div>
  </form>
</div>
{% endblock %}
