{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-xl-7">
      <div class="card shadow p-4 animate__animated animate__fadeIn">
        <h4 class="mb-4 text-primary"><i class="bi bi-folder-plus me-2"></i> Nouvelle Catégorie</h4>

        <form method="POST" enctype="multipart/form-data" id="clientForm" novalidate>
          {% csrf_token %}

          <div class="mb-3">
            <label for="nom" class="form-label">Nom catégorie</label>
            <input type="text" class="form-control" id="nom" name="nom" placeholder="Ex: Accessoires" required>
            <div class="invalid-feedback">Le nom est requis.</div>
          </div>

          <!-- DRAG & DROP FILE UPLOAD -->
          <div class="mb-3">
            <label class="form-label">Photo</label>
            <div id="dropZone" class="drop-zone text-center p-4 border border-2 border-dashed rounded bg-light animate__animated">
              <input type="file" name="photo" id="fileInput" class="d-none" accept="image/*" required>
              <i class="bi bi-cloud-upload display-4 text-secondary mb-2"></i>
              <p class="text-muted mb-0">Glissez-déposez une image ici<br>ou cliquez pour sélectionner un fichier</p>
              <div id="preview" class="mt-3 d-none">
                <img src="" class="img-thumbnail" style="max-height: 200px;" alt="Aperçu">
              </div>
            </div>
            <div class="invalid-feedback d-block">Veuillez ajouter une photo.</div>
          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-success">
              <i class="bi bi-check-circle me-1"></i> Enregistrer
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- STYLES -->
<style>
  .drop-zone {
    transition: all 0.3s ease-in-out;
    cursor: pointer;
    background-color: #f8f9fa;
  }

  .drop-zone.dragover {
    border-color: #0d6efd !important;
    background-color: #e9f5ff;
  }

  .drop-zone:hover {
    background-color: #f0f8ff;
  }
</style>

<!-- SCRIPT -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const imgPreview = preview.querySelector('img');
    const form = document.getElementById('clientForm');

    // Click sur la zone = ouvrir file input
    dropZone.addEventListener('click', () => fileInput.click());

    // Drag over
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, e => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      });
    });

    // Drag leave + drop
    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, e => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
      });
    });

    // Drop files
    dropZone.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        showPreview(files[0]);
      }
    });

    // File input classique
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length > 0) {
        showPreview(fileInput.files[0]);
      }
    });

    // Afficher l'aperçu
    function showPreview(file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        imgPreview.src = e.target.result;
        preview.classList.remove('d-none');
      };
      reader.readAsDataURL(file);
    }

    // Validation formulaire
    form.addEventListener('submit', function (e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
      }

      form.classList.add('was-validated');
    });
  });
</script>
{% endblock %}
