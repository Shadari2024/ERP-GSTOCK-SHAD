<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
            @bottom-center {
                content: "Page " counter(page) " sur " counter(pages);
                font-size: 10px;
                color: #666;
            }
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }
        .header h2 {
            color: #2c3e50;
            font-size: 22px;
            margin: 0 0 5px 0;
            padding: 0;
        }
        .company-info {
            font-size: 10px;
            color: #666;
            line-height: 1.4;
        }
        .document-title {
            background-color: #2c3e50;
            color: white;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            font-weight: bold;
        }
        .document-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 15px;
        }
        .info-block {
            width: 48%;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 11px;
        }
        th {
            background-color: #2c3e50;
            color: white;
            padding: 8px;
            font-weight: bold;
            text-align: center;
        }
        td {
            border: 1px solid #ddd;
            padding: 6px 8px;
        }
        .text-right {
            text-align: right;
        }
        .text-center {
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .total-row {
            font-weight: bold;
            background-color: #f1f1f1;
        }
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        .signature-block {
            width: 45%;
            text-align: center;
        }
        .signature-line {
            border-top: 1px solid #333;
            width: 70%;
            margin: 40px auto 5px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 10px;
            color: #666;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .highlight {
            font-weight: bold;
            color: #2c3e50;
        }
        .logo {
            max-height: 60px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="header">
        <!-- Ajoutez votre logo ici si disponible -->
        <!-- <img src="chemin/vers/logo.png" class="logo" alt="Logo"> -->
        <h2>{{ bon.parametre.nom_societe|upper|default:"NOM ENTREPRISE" }}</h2>
        <div class="company-info">
            {{ bon.parametre.adresse|default:"Adresse de l'entreprise" }}<br>
            Tél: {{ bon.parametre.telephone|default:"00 00 00 00 00" }} | 
            Email: {{ bon.parametre.email|default:"contact@entreprise.com" }}<br>
            {% if bon.parametre.rc %}{{ bon.parametre.rc }}{% endif %}
            {% if bon.parametre.ice %} | ICE: {{ bon.parametre.ice }}{% endif %}
        </div>
    </div>

    <div class="document-title">
        BON DE LIVRAISON N° {{ bon.id }}
    </div>

    <div class="document-info">
        <div class="info-block">
            <div><span class="highlight">Date de livraison:</span> {{ bon.date_livraison|date:"d/m/Y" }}</div>
            <div><span class="highlight">Préparé par:</span> {{ bon.cree_par.get_full_name|default:bon.cree_par.username }}</div>
            <div><span class="highlight">Transporteur:</span> {{ bon.transporteur|default:"Non spécifié" }}</div>
        </div>
        <div class="info-block">
            <div><span class="highlight">Client:</span> {{ bon.client.nom }}</div>
            <div><span class="highlight">Commande N°:</span> {{ bon.commande.id }}</div>
            <div><span class="highlight">Date commande:</span> {{ bon.commande.date_commande|date:"d/m/Y" }}</div>
            {% if bon.client.telephone %}<div><span class="highlight">Tél client:</span> {{ bon.client.telephone }}</div>{% endif %}
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="45%">Désignation</th>
                <th width="10%" class="text-center">Qté</th>
                <th width="15%" class="text-right">Prix unitaire</th>
                <th width="15%" class="text-right">Montant</th>
            </tr>
        </thead>
        <tbody>
            <tbody>
                {% for ligne in bon.commande.lignes.all %}
                <tr>
                    <td>{{ ligne.produit.nom }}</td>
                    <td class="text-center">{{ ligne.quantite }}</td>
                    <td class="text-right">{{ ligne.prix_unitaire|floatformat:2 }} {{ bon.parametre.devise|default:"FC" }}</td>
                    <td class="text-right">
                        {% widthratio ligne.quantite 1 ligne.prix_unitaire as total %}
                        {{ total|floatformat:2 }} {{ bon.parametre.devise|default:"FC" }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Aucun produit à livrer</td>
                </tr>
                {% endfor %}
    
                <!-- Ligne de total -->
                <!-- Ligne de total -->
<tr class="total-row">
    <td colspan="1" class="text-right"><strong>TOTAL</strong></td>
    <td class="text-center"><strong>{{ quantite_totale }}</strong></td>
    <td></td>
    <td class="text-right">
        <strong>{{ montant_total|floatformat:2 }} {{ bon.parametre.devise|default:"FC" }}</strong>
    </td>
</tr>

            </tbody>
    
            </tr>
        </tbody>
    </table>

    <div class="signature-section">
        <div class="signature-block">
            <div class="signature-line"></div>
            <div>Signature du responsable</div>
            <div style="margin-top: 5px; font-size: 10px;">Cachet et signature</div>
        </div>
        <div class="signature-block">
            <div class="signature-line"></div>
            <div>Signature du client</div>
            <div style="margin-top: 5px; font-size: 10px;">Nom et cachet</div>
        </div>
    </div>

    <div class="footer">
        <p>{{ bon.parametre.nom_societe|default:"NOM ENTREPRISE" }} - {{ bon.parametre.adresse|default:"Adresse de l'entreprise" }}</p>
        <p>Tél: {{ bon.parametre.telephone|default:"00 00 00 00 00" }} | Email: {{ bon.parametre.email|default:"contact@entreprise.com" }}</p>
        <p>Merci pour votre confiance.</p>
    </div>

</body>
</html>